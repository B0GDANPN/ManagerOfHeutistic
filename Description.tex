\documentclass[12pt]{article}
\input{Preambles/preamble.tex}
\begin{document}
\begin{flushleft}
\section*{Описание Менеджера эвристик}
Из сложности DPsize:
\begin{align*}
    I^{\text{chain}}_{\text{DPsize}}(n) &=
    \begin{cases}
        \frac{1}{48} (5n^4 + 6n^3 - 14n^2 - 12n), & n \text{ even} \\
        \frac{1}{48} (5n^4 + 6n^3 - 14n^2 - 6n + 11), & n \text{ odd}
    \end{cases}
    \\
    I^{\text{cycle}}_{\text{DPsize}}(n) &=
    \begin{cases}
        \frac{1}{4} (n^4 - n^3 - n^2), & n \text{ even} \\
        \frac{1}{4} (n^4 - n^3 - n^2 + n), & n \text{ odd}
    \end{cases}
    \\
    I^{\text{star}}_{\text{DPsize}}(n) &=
    \begin{cases}
        2^{2n-4} - \frac{1}{4} \binom{2n}{n-1} + q(n), & n \text{ even} \\
        2^{2n-4} - \frac{1}{4} \binom{2(n-1)}{(n-1)} + \frac{1}{4} \binom{(n-1)}{(n-1)/2} + q(n), & n \text{ odd}
    \end{cases}
    \\
    \text{with } q(n) &= n 2^{2n-1} - 5 \times 2^{n-3} + \frac{1}{2} (2^n - 5n + 4)
    \\
    I^{\text{clique}}_{\text{DPsize}}(n) &=
    \begin{cases}
        2^{2n-2} - 5 \times 2^{n-2} + \frac{1}{4} \binom{2n}{n} - \frac{1}{4} \binom{n}{n/2} + 1, & n \text{ even} \\
        2^{2n-2} - 5 \times 2^{n-2} + \frac{1}{4} \binom{2n}{n} + 1, & n \text{ odd}
    \end{cases}
\end{align*}
Заметим, что для цепей, циклов, звёзд с небольшим количестом таблиц, DPsize обладает быстрым временем планирования, следовательное эвристики нужно использовать для крупных топологий.
Заметим, что плотные графы $\sim$ \text{clique} обладают высокой алгоритмической сложностью планирования
алгоритмом DPsize. Поэтому все такие графы от 6+ вершин будем отдавать Geqo. 
Заметим, что также крупные звёзды обладают высокой сложностью. Их можно разбить на цепи по центральной вершине.
Посмотрим на сложность планирования цепей и циклов: при количестве таблиц $\leqq 12$ сложность циклов не более чем в 2 раза 
больше сложности цепи. Таким образом, при количестве таблиц $\leqq geqo\_threshold$ в цепи(цикле) будем применять стандартный DP.

Пусть дан большой($\geqq 50$ таблиц) аналитический запрос с внутренними соединениями. Для его планирования будем выполнять 
следующие шаги:
\begin{enumerate}
    \item Представим запрос в виде набора связных компонент, любые две таблицы из разных компонент не имеют условия соединения между собой. 
Для каждой компоненты будем выполнять шаги 2-4.
    \item Разобьём компоненту на топологии: сначала выделим из компоненты \textbf{плотные графы} (с 6+ вершинами), затем циклы(*), звёзды, останутся цепи. 
Звездой назовём группу вершин: центральная и связанные с ней цепи, каждые две цепи не связаны с друг другом в оставшейся топологии. Или если имеется 
вершина с количеством строк в 10+ раз больше чем у 2+ соседей, то данная вершина станет центральной, а её соседи будут концами цепочек.\newline (*)Если после выделения 
плотных графов и циклов, компонента остаеётся связной, то для планирования этого дерева используем linDP (т.к позволяет получить очень близкие к оптимальным планы за разумное время), иначе выделяем звёзды и цепи.
    \item Назовём топологию маленькой, если в ней $\leq geqo\_threshold$ элементов, иначе топология большая. Спланируем каждую топологию графа:\newline
    \begin{enumerate}
        \item Для маленькой цепи будем использовать DPsize. Для большой будем брать минимальный (по общей стоимости) из результатов планирования 
        GOO (по кардинальности) и Geqo.
        \item Для маленького цикла будем использовать DPsize. В большом цикле найдем соединение с наибольшей кардинальностью, и разобьём цикл 
        по этом соединению - уберём одну таблицу в этом соединении. Спланируем цепь, и присоединим удалённую таблицу.
        \item Маленькую звезду спланируем DPsize. Для большой - сначала спланируем лучи как цепи, затем будем последовательно присоединять к 
        центру использую GOO (по кардинальности) с центральной фиксированной вершиной.
        \item Плотный граф от $\leq 6$ вершин будем планировать DPsize. Для больших плотных графов будем использовать Geqo.
    \end{enumerate}
    \item Алгоритмом GOO(по кардинальности) соберём все планы компоненты в один результат.
    \item Объединим планы компонент алгоритмом GOO(по кардинальности) с помощью декартового произведения.
\end{enumerate}

Внутри алгоритма GOO будем переключаться на DPsize с передачей частичных результатов, если на каком-то шаге минимальное по кардинальности соединение будет близко к декартовому произведению и 
количество элементов будет $\leqq geqo\_threshold$. Однако для соединения планов связных компонент графа переключаться не будем. 

\raggedright

\end{flushleft}
\end{document}
